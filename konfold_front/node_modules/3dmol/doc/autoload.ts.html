

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>3Dmol.js Documentation autoload.ts</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="../tutorials/style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item"><a href="http://3dmol.org"><b>3Dmol</b>.js</a></h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-code.html">
                                Using 3Dmol within your code
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-embeddable.html">
                                Embedding a 3Dmol Viewer
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-learning_environment.html">
                                Active Learning with 3Dmol.js
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-url.html">
                                Viewing Molecules with the 3Dmol Server
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/3dmol/3Dmol.js"
                        >
                            Github
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="GLDraw.html">GLDraw</a></li></ul><h3>Classes</h3><ul><li><a href="$3Dmol.Label.html">Label</a></li><li><a href="$3Dmol.UI.html">UI</a></li><li><a href="Color.html">Color</a></li><li><a href="GLModel.html">GLModel</a></li><li><a href="GLShape.html">GLShape</a></li><li><a href="GLShape_GLShape.html">GLShape</a></li><li><a href="GLViewer.html">GLViewer</a></li><li><a href="GLVolumetricRender.html">GLVolumetricRender</a></li><li><a href="VolumeData.html">VolumeData</a></li></ul><h3>Classes / Gradients</h3><ul><li><a href="CustomLinear.html">CustomLinear</a></li><li><a href="ROYGB.html">ROYGB</a></li><li><a href="RWB.html">RWB</a></li><li><a href="Sinebow.html">Sinebow</a></li></ul><h3>Classes / Math</h3><ul><li><a href="Cylinder.html">Cylinder</a></li><li><a href="Matrix3.html">Matrix3</a></li><li><a href="Matrix4.html">Matrix4</a></li><li><a href="Quaternion.html">Quaternion</a></li><li><a href="Ray.html">Ray</a></li><li><a href="Sphere.html">Sphere</a></li><li><a href="Triangle.html">Triangle</a></li><li><a href="Vector2.html">Vector2</a></li><li><a href="Vector3.html">Vector3</a></li></ul><h3>Interfaces</h3><ul><li><a href="ArrowSpec.html">ArrowSpec</a></li><li><a href="AtomSelectionSpec.html">AtomSelectionSpec</a></li><li><a href="AtomSpec.html">AtomSpec</a></li><li><a href="AtomStyleSpec.html">AtomStyleSpec</a></li><li><a href="BondStyle.html">BondStyle</a></li><li><a href="BoxSpec.html">BoxSpec</a></li><li><a href="CartoonStyleSpec.html">CartoonStyleSpec</a></li><li><a href="ClickSphereStyleSpec.html">ClickSphereStyleSpec</a></li><li><a href="CrossStyleSpec.html">CrossStyleSpec</a></li><li><a href="CurveSpec.html">CurveSpec</a></li><li><a href="CustomShapeSpec.html">CustomShapeSpec</a></li><li><a href="CylinderSpec.html">CylinderSpec</a></li><li><a href="IsoSurfaceSpec.html">IsoSurfaceSpec</a></li><li><a href="LabelSpec.html">LabelSpec</a></li><li><a href="LineSpec.html">LineSpec</a></li><li><a href="LineStyleSpec.html">LineStyleSpec</a></li><li><a href="ShapeSpec.html">ShapeSpec</a></li><li><a href="SphereSpec.html">SphereSpec</a></li><li><a href="SphereStyleSpec.html">SphereStyleSpec</a></li><li><a href="StickStyleSpec.html">StickStyleSpec</a></li><li><a href="SurfaceStyleSpec.html">SurfaceStyleSpec</a></li><li><a href="UnitCellStyleSpec.html">UnitCellStyleSpec</a></li><li><a href="ViewerGridSpec.html">ViewerGridSpec</a></li><li><a href="ViewerSpec.html">ViewerSpec</a></li><li><a href="VolumetricRendererSpec.html">VolumetricRendererSpec</a></li><li><a href="WithinSelectionSpec.html">WithinSelectionSpec</a></li><li><a href="global.html#XYZ">XYZ</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CAP">CAP</a></li><li><a href="global.html#SurfaceType">SurfaceType</a></li><li><a href="global.html#bondLength">bondLength</a></li><li><a href="global.html#builtinColorSchemes">builtinColorSchemes</a></li><li><a href="global.html#conversionMatrix3">conversionMatrix3</a></li><li><a href="global.html#createViewer">createViewer</a></li><li><a href="global.html#createViewerGrid">createViewerGrid</a></li><li><a href="global.html#download">download</a></li><li><a href="global.html#elementColors">elementColors</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getbin">getbin</a></li><li><a href="global.html#setBondLength">setBondLength</a></li><li><a href="global.html#ssColors">ssColors</a></li><li><a href="global.html#syncSurface">syncSurface</a></li><li><a href="global.html#viewers">viewers</a></li></ul></div><div class="category"><h2>Parsers</h2><h3>Interfaces</h3><ul><li><a href="ParserOptionsSpec.html">ParserOptionsSpec</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CDJSON">CDJSON</a></li><li><a href="global.html#CIF">CIF</a></li><li><a href="global.html#CUBE">CUBE</a></li><li><a href="global.html#GRO">GRO</a></li><li><a href="global.html#LAMMPSTRJ">LAMMPSTRJ</a></li><li><a href="global.html#MMTFparser">MMTFparser</a></li><li><a href="global.html#MOL2">MOL2</a></li><li><a href="global.html#PDB">PDB</a></li><li><a href="global.html#PQR">PQR</a></li><li><a href="global.html#PRMTOP">PRMTOP</a></li><li><a href="global.html#SDF">SDF</a></li><li><a href="global.html#VASP">VASP</a></li><li><a href="global.html#XYZ">XYZ</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>autoload.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//auto-initialization

import { createViewer } from "./GLViewer";
import { SurfaceType } from "./ProteinSurface4";
import { get, specStringToObject } from "./utilities";
import { CC } from "./colors";

export var autoinit = false;
export var processing_autoinit = false;

/**
 * Contains a dictionary of embedded viewers created from HTML elements
 * with a the viewer_3Dmoljs css class indexed by their id (or numerically
 * if they do not have an id).
*/
export var viewers: any = {};

//Create embedded viewer from HTML attributes if true
//viewer and callback are used by the testing harness
export function autoload(viewer?, callback?) {
    var i, dataname, type;
    if (document.querySelector(".viewer_3Dmoljs") != null)
        autoinit = true;

    if (autoinit) {
        processing_autoinit = true;
        viewer = (viewer != undefined) ? viewer : null;
        var nviewers = 0;
        document.querySelectorAll&lt;HTMLInputElement>(".viewer_3Dmoljs").forEach(viewerdiv => {
            var datauri = [];
            var datatypes = [];
            var uri = '';

            if (viewerdiv.style.position == 'static') {
                //slight hack - canvas needs this element to be positioned
                viewerdiv.style.position = 'relative';
            }

            var UI:any = null;

            type = null;
            if (viewerdiv.dataset.pdb) {
                datauri.push("https://files.rcsb.org/view/" + viewerdiv.dataset.pdb + ".pdb");
                datatypes.push("pdb");
            } else if (viewerdiv.dataset.cid) {
                //this doesn't actually work since pubchem does have CORS enabled
                datatypes.push("sdf");
                datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" + viewerdiv.dataset.cid +
                    "/SDF?record_type=3d");
            }
            else if (viewerdiv.dataset.href || viewerdiv.dataset.url) {
                if (viewerdiv.dataset.href)
                    uri = viewerdiv.dataset.href;
                else
                    uri = viewerdiv.dataset.url;
                datauri.push(uri);
                type = uri.substring(uri.lastIndexOf('.') + 1);
                datatypes.push(type);

                var molName = uri.substring(uri.lastIndexOf('/') + 1, uri.lastIndexOf('.'));
                if (molName == '/')
                    molName = uri.substring(uri.lastIndexOf('/') + 1);

                viewerdiv.dataset[datatypes[datatypes.length - 1]] = molName;
            }

            var divdata = viewerdiv.dataset;
            for (i in divdata) {
                if ((i.substring(0, 3) === "pdb" &amp;&amp; (i !== "pdb"))) {
                    datauri.push("https://files.rcsb.org/view/" + divdata[i] + ".pdb");
                    datatypes.push('pdb');

                } else if (i.substring(0, 4) === "href" &amp;&amp; (i !== "href")) {
                    uri = divdata[i];
                    datauri.push(uri);
                    datatypes.push(uri.substr(uri.lastIndexOf('.') + 1));
                } else if (i.substring(0, 3) === "cid" &amp;&amp; (i !== "cid")) {
                    datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" + divdata[i] + "/SDF?record_type=3d");
                    datatypes.push('sdf');
                }
            }
            var options = {};
            if (viewerdiv.dataset.options)
                options = specStringToObject(viewerdiv.dataset.options);

            //note that data tags must be lowercase
            var bgcolor = CC.color(viewerdiv.dataset.backgroundcolor);
            var bgalpha: string | number = viewerdiv.dataset.backgroundalpha;
            bgalpha = (bgalpha == undefined) ? 1.0 : parseFloat(bgalpha);
            var style = { line: {} };
            if (viewerdiv.dataset.style) style = specStringToObject(viewerdiv.dataset.style);
            var select = {};
            if (viewerdiv.dataset.select) select = specStringToObject(viewerdiv.dataset.select);
            var selectstylelist = [];
            var surfaces = [];
            var labels = [];
            var zoomto = {};
            var spin = null;
            var d = viewerdiv.dataset;

            //let users specify individual but matching select/style/surface tags, eg.
            //data-select1 data-style1
            var stylere = /style(.+)/;
            var surfre = /surface(.*)/;
            var reslabre = /labelres(.*)/;
            var keys = [];
            for (dataname in d) {
                if (Object.prototype.hasOwnProperty.call(d, dataname)) {
                    keys.push(dataname);
                }
            }
            keys.sort();
            for (i = 0; i &lt; keys.length; i++) {
                dataname = keys[i];
                var m = stylere.exec(dataname);
                var selname, newsel, styleobj;
                if (m) {
                    selname = "select" + m[1];
                    newsel = specStringToObject(d[selname]);
                    styleobj = specStringToObject(d[dataname]);
                    selectstylelist.push([newsel, styleobj]);
                }
                m = surfre.exec(dataname);
                if (m) {
                    selname = "select" + m[1];
                    newsel = specStringToObject(d[selname]);
                    styleobj = specStringToObject(d[dataname]);
                    surfaces.push([newsel, styleobj]);
                }
                m = reslabre.exec(dataname);
                if (m) {
                    selname = "select" + m[1];
                    newsel = specStringToObject(d[selname]);
                    styleobj = specStringToObject(d[dataname]);
                    labels.push([newsel, styleobj]);
                }
                if (dataname == "zoomto") {
                    zoomto = specStringToObject(d[dataname]);
                }
                if (dataname == "spin") {
                    spin = specStringToObject(d[dataname]);
                }
            }

            //apply all the selections/styles parsed out above to the passed viewer
            var applyStyles = function (glviewer) {
                glviewer.setStyle(select, style);

                if (UI) {
                    UI.createSelectionAndStyle(select, style);
                }

                for (i = 0; i &lt; selectstylelist.length; i++) {
                    let sel = selectstylelist[i][0] || {};
                    let sty = selectstylelist[i][1] || { "line": {} };
                    glviewer.setStyle(sel, sty);
                    if (UI) {
                        UI.createSelectionAndStyle(select, style);
                    }
                }
                for (i = 0; i &lt; surfaces.length; i++) {
                    let sel = surfaces[i][0] || {};
                    let sty = surfaces[i][1] || {};
                    let viewer = glviewer;

                    if (UI) {
                        viewer.addSurface(SurfaceType.VDW, sty, sel, sel).then((surfid) => {
                            UI.loadSurface("VDW", sel, sty, surfid);
                        });
                    }
                    else {
                        glviewer.addSurface(SurfaceType.VDW, sty, sel, sel);
                    }

                }
                for (i = 0; i &lt; labels.length; i++) {
                    let sel = labels[i][0] || {};
                    let sty = labels[i][1] || {};
                    glviewer.addResLabels(sel, sty);
                }

                glviewer.render();
                glviewer.zoomTo(zoomto);

                if (spin) {
                    glviewer.spin(spin.axis, spin.speed);
                }
            };

            var glviewer = viewer;
            try {
                var config: any = specStringToObject(viewerdiv.dataset.config) || {};
                if (config.backgroundColor === undefined) config.backgroundColor = bgcolor;
                if (config.backgroundAlpha === undefined) config.backgroundAlpha = bgalpha;
                if (glviewer == null) {
                    glviewer = viewers[viewerdiv.id || nviewers++] = createViewer(viewerdiv, config);
                } else {
                    glviewer.setBackgroundColor(bgcolor, bgalpha);
                    glviewer.setConfig(config);
                    if (UI) 
                        UI.initiateUI();
                }

                if(viewerdiv.dataset.ui &amp;&amp; $3Dmol.StateManager) {
                    UI = new $3Dmol.StateManager(glviewer); // Creates the UI state management tool
                }
            } catch (error) {
                console.log(error);
                //for autoload, provide a useful error message
                viewerdiv.textContent = "WebGL appears to be disabled.";
            }

            if (datauri.length != 0) {
                //load multiple data elements in serial
                i = 0;
                var process = function (moldata) {
                    //add moldata to viewer and load next model
                    uri = datauri[i]; //this is where the moldata came from
                    var type = viewerdiv.dataset.type || viewerdiv.dataset.datatype || datatypes[i];
                    glviewer.addModel(moldata, type, options);
                    if (UI) {
                        var modelName = viewerdiv.dataset[datatypes[i]];
                        UI.setModelTitle(modelName);
                    }
                    i += 1;
                    if (i &lt; datauri.length) {
                        get(datauri[i]).then(process);
                    }
                    else {
                        // or finalize if this is the last model
                        applyStyles(glviewer);
                        if (viewerdiv.dataset.callback) {
                            //evaluate javascript in the string, if it resolves to a function,
                            //call it with the viewer
                            /*jshint -W061 */ var runres = eval(viewerdiv.dataset.callback);
                            if (typeof (runres) == 'function') {
                                runres(glviewer);
                            }
                        }
                        processing_autoinit = false;
                        if (callback) callback(glviewer);
                    }
                };
                get(datauri[0]).then(process);

            }
            else {

                if (viewerdiv.dataset.element) {
                    var moldataid = "#" + viewerdiv.dataset.element;
                    var molelem = document.querySelector(moldataid);
                    var moldata = molelem ? molelem.textContent : "";
                    type = viewerdiv.dataset.type || viewerdiv.dataset.datatype;
                    glviewer.addModel(moldata, type, options);
                }

                applyStyles(glviewer);
                if (viewerdiv.dataset.callback) {
                    //evaluate javascript in the string, if it resolves to a function,
                    //call it with the viewer
                    /*jshint -W061 */ var runres = eval(viewerdiv.dataset.callback);
                    if (typeof (runres) == 'function') {
                        runres(glviewer);
                    }
                }
                processing_autoinit = false;
                if (callback)
                    callback(glviewer);
            }
        });
    }
};



document.onreadystatechange = () => {
    if (document.readyState === "complete") {
        autoload();
    }
};
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>hljs.highlightAll();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
