

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>3Dmol.js Documentation Gradient.ts</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="../tutorials/style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item"><a href="http://3dmol.org"><b>3Dmol</b>.js</a></h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-code.html">
                                Using 3Dmol within your code
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-embeddable.html">
                                Embedding a 3Dmol Viewer
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-learning_environment.html">
                                Active Learning with 3Dmol.js
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-url.html">
                                Viewing Molecules with the 3Dmol Server
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/3dmol/3Dmol.js"
                        >
                            Github
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="GLDraw.html">GLDraw</a></li></ul><h3>Classes</h3><ul><li><a href="$3Dmol.Label.html">Label</a></li><li><a href="$3Dmol.UI.html">UI</a></li><li><a href="Color.html">Color</a></li><li><a href="GLModel.html">GLModel</a></li><li><a href="GLShape.html">GLShape</a></li><li><a href="GLShape_GLShape.html">GLShape</a></li><li><a href="GLViewer.html">GLViewer</a></li><li><a href="GLVolumetricRender.html">GLVolumetricRender</a></li><li><a href="VolumeData.html">VolumeData</a></li></ul><h3>Classes / Gradients</h3><ul><li><a href="CustomLinear.html">CustomLinear</a></li><li><a href="ROYGB.html">ROYGB</a></li><li><a href="RWB.html">RWB</a></li><li><a href="Sinebow.html">Sinebow</a></li></ul><h3>Classes / Math</h3><ul><li><a href="Cylinder.html">Cylinder</a></li><li><a href="Matrix3.html">Matrix3</a></li><li><a href="Matrix4.html">Matrix4</a></li><li><a href="Quaternion.html">Quaternion</a></li><li><a href="Ray.html">Ray</a></li><li><a href="Sphere.html">Sphere</a></li><li><a href="Triangle.html">Triangle</a></li><li><a href="Vector2.html">Vector2</a></li><li><a href="Vector3.html">Vector3</a></li></ul><h3>Interfaces</h3><ul><li><a href="ArrowSpec.html">ArrowSpec</a></li><li><a href="AtomSelectionSpec.html">AtomSelectionSpec</a></li><li><a href="AtomSpec.html">AtomSpec</a></li><li><a href="AtomStyleSpec.html">AtomStyleSpec</a></li><li><a href="BondStyle.html">BondStyle</a></li><li><a href="BoxSpec.html">BoxSpec</a></li><li><a href="CartoonStyleSpec.html">CartoonStyleSpec</a></li><li><a href="ClickSphereStyleSpec.html">ClickSphereStyleSpec</a></li><li><a href="CrossStyleSpec.html">CrossStyleSpec</a></li><li><a href="CurveSpec.html">CurveSpec</a></li><li><a href="CustomShapeSpec.html">CustomShapeSpec</a></li><li><a href="CylinderSpec.html">CylinderSpec</a></li><li><a href="IsoSurfaceSpec.html">IsoSurfaceSpec</a></li><li><a href="LabelSpec.html">LabelSpec</a></li><li><a href="LineSpec.html">LineSpec</a></li><li><a href="LineStyleSpec.html">LineStyleSpec</a></li><li><a href="ShapeSpec.html">ShapeSpec</a></li><li><a href="SphereSpec.html">SphereSpec</a></li><li><a href="SphereStyleSpec.html">SphereStyleSpec</a></li><li><a href="StickStyleSpec.html">StickStyleSpec</a></li><li><a href="SurfaceStyleSpec.html">SurfaceStyleSpec</a></li><li><a href="UnitCellStyleSpec.html">UnitCellStyleSpec</a></li><li><a href="ViewerGridSpec.html">ViewerGridSpec</a></li><li><a href="ViewerSpec.html">ViewerSpec</a></li><li><a href="VolumetricRendererSpec.html">VolumetricRendererSpec</a></li><li><a href="WithinSelectionSpec.html">WithinSelectionSpec</a></li><li><a href="global.html#XYZ">XYZ</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CAP">CAP</a></li><li><a href="global.html#SurfaceType">SurfaceType</a></li><li><a href="global.html#bondLength">bondLength</a></li><li><a href="global.html#builtinColorSchemes">builtinColorSchemes</a></li><li><a href="global.html#conversionMatrix3">conversionMatrix3</a></li><li><a href="global.html#createViewer">createViewer</a></li><li><a href="global.html#createViewerGrid">createViewerGrid</a></li><li><a href="global.html#download">download</a></li><li><a href="global.html#elementColors">elementColors</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getbin">getbin</a></li><li><a href="global.html#setBondLength">setBondLength</a></li><li><a href="global.html#ssColors">ssColors</a></li><li><a href="global.html#syncSurface">syncSurface</a></li><li><a href="global.html#viewers">viewers</a></li></ul></div><div class="category"><h2>Parsers</h2><h3>Interfaces</h3><ul><li><a href="ParserOptionsSpec.html">ParserOptionsSpec</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CDJSON">CDJSON</a></li><li><a href="global.html#CIF">CIF</a></li><li><a href="global.html#CUBE">CUBE</a></li><li><a href="global.html#GRO">GRO</a></li><li><a href="global.html#LAMMPSTRJ">LAMMPSTRJ</a></li><li><a href="global.html#MMTFparser">MMTFparser</a></li><li><a href="global.html#MOL2">MOL2</a></li><li><a href="global.html#PDB">PDB</a></li><li><a href="global.html#PQR">PQR</a></li><li><a href="global.html#PRMTOP">PRMTOP</a></li><li><a href="global.html#SDF">SDF</a></li><li><a href="global.html#VASP">VASP</a></li><li><a href="global.html#XYZ">XYZ</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>Gradient.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { CC, Color } from "./colors";

export abstract class GradientType {
  gradient?: string;
  abstract valueToHex(value: number, range?: number[]): number;
  abstract range(): number[] | null;
}

export function normalizeValue(
  lo: number,
  hi: number,
  val: number
): { lo: number; hi: number; val: number } {
  if (hi >= lo) {
    if (val &lt; lo) val = lo;
    if (val > hi) val = hi;
    return { lo: lo, hi: hi, val: val };
  } else {
    if (val > lo) val = lo;
    if (val &lt; hi) val = hi;
    //flip the meaning of val, lo, hi
    val = lo - val + hi;
    return { lo: hi, hi: lo, val: val };
  }
}

//return a Gradient object, even if what is specified is descriptive
export function getGradient(grad): GradientType {
  if (grad instanceof GradientType) {
    return grad;
  } else if (
    grad.gradient !== undefined &amp;&amp;
    builtinGradients[grad.gradient]
  ) {
    let min = grad.min === undefined ? -1 : grad.min;
    let max = grad.max === undefined ? 1 : grad.max;
    if (grad.mid === undefined) {
      if (grad.colors === undefined) {
        return new builtinGradients[grad.gradient](min, max);
      } else {
        return new builtinGradients[grad.gradient](min, max, grad.colors);
      }
    } else {
      return new builtinGradients[grad.gradient](min, max, grad.mid);
    }
  }
  return grad;
}

/**
 * Color scheme red to white to blue, for charges
 * Reverse gradients are supported when min>max so that the colors are displayed in reverse order.
 * @subcategory Gradients
 */
export class RWB extends GradientType {
  gradient = "RWB";
  min: number;
  max: number;
  mid?: number;
  mult: number;
  constructor(min?: number | [number, number], max?: number, mid?: number) {
    super();
    this.mult = 1.0;
    this.mid = mid;
    this.min = min as number;
    this.max = max as number;
    if (typeof max == "undefined" &amp;&amp; Array.isArray(min) &amp;&amp; min.length >= 2) {
      //we were passed a single range
      this.max = min[1];
      this.min = min[0];
    } else if (!!min &amp;&amp; !!max &amp;&amp; !Array.isArray(min)) {
      this.min = min;
      this.max = max;
    }
  }

  //return range used for color mapping, null if none set
  range() {
    if (typeof this.min != "undefined" &amp;&amp; typeof this.max != "undefined") {
      return [this.min, this.max] as [number, number];
    }
    return null;
  }

  //map value to hex color, range is provided
  valueToHex(val, range) {
    var lo, hi;
    val = this.mult * val; //reverse if necessary
    if (range) {
      lo = range[0];
      hi = range[1];
    } else {
      lo = this.min;
      hi = this.max;
    }

    if (val === undefined) return 0xffffff;

    var norm = normalizeValue(lo, hi, val);
    lo = norm.lo;
    hi = norm.hi;
    val = norm.val;

    var middle = (hi + lo) / 2;
    if (range &amp;&amp; typeof range[2] != "undefined") middle = range[2];
    else if (typeof this.mid != "undefined")
      middle = this.mid; //allow user to specify midpoint
    else middle = (lo + hi) / 2;
    var scale, color;

    //scale bottom from red to white
    if (val &lt; middle) {
      scale = Math.floor(255 * Math.sqrt((val - lo) / (middle - lo)));
      color = 0xff0000 + 0x100 * scale + scale;
      return color;
    } else if (val > middle) {
      //form white to blue
      scale = Math.floor(255 * Math.sqrt(1 - (val - middle) / (hi - middle)));
      color = 0x10000 * scale + 0x100 * scale + 0xff;
      return color;
    } else {
      //val == middle
      return 0xffffff;
    }
  }
}

/**
 * rainbow gradient, but without purple to match jmol
 * Reverse gradients are supported when min>max so that the colors are displayed in reverse order.
 * @subcategory Gradients
 */
export class ROYGB extends GradientType {
  gradient = "ROYGB";
  mult: number;
  max: number;
  min: number;
  constructor(min, max) {
    super();
    this.mult = 1.0;
    this.min = min;
    this.max = max;
    if (typeof max == "undefined" &amp;&amp; Array.isArray(min) &amp;&amp; min.length >= 2) {
      //we were passed a single range
      this.max = min[1];
      this.min = min[0];
    } else if (!!min &amp;&amp; !!max &amp;&amp; !Array.isArray(min)) {
      this.min = min;
      this.max = max;
    }
  };
  //map value to hex color, range is provided
  valueToHex(val, range) {
    var lo, hi;
    val = this.mult * val;
    if (range) {
      lo = range[0];
      hi = range[1];
    } else {
      lo = this.min;
      hi = this.max;
    }

    if (typeof val == "undefined") return 0xffffff;

    var norm = normalizeValue(lo, hi, val);
    lo = norm.lo;
    hi = norm.hi;
    val = norm.val;

    var mid = (lo + hi) / 2;
    var q1 = (lo + mid) / 2;
    var q3 = (mid + hi) / 2;

    var scale, color;
    if (val &lt; q1) {
      //scale green up, red up, blue down
      scale = Math.floor(255 * Math.sqrt((val - lo) / (q1 - lo)));
      color = 0xff0000 + 0x100 * scale + 0;
      return color;
    } else if (val &lt; mid) {
      //scale red down, green up, blue down
      scale = Math.floor(255 * Math.sqrt(1 - (val - q1) / (mid - q1)));
      color = 0x010000 * scale + 0xff00 + 0x0;
      return color;
    } else if (val &lt; q3) {
      //scale blue up, red down, green up
      scale = Math.floor(255 * Math.sqrt((val - mid) / (q3 - mid)));
      color = 0x000000 + 0xff00 + 0x1 * scale;
      return color;
    } else {
      //scale green down, blue up, red down
      scale = Math.floor(255 * Math.sqrt(1 - (val - q3) / (hi - q3)));
      color = 0x000000 + 0x0100 * scale + 0xff;
      return color;
    }
  };

  //return range used for color mapping, null if none set
  range() {
    if (typeof this.min != "undefined" &amp;&amp; typeof this.max != "undefined") {
      return [this.min, this.max] as [number, number];
    }
    return null;
  };
}
/**
 * rainbow gradient with constant saturation, all the way to purple!
 * Reverse gradients are supported when min>max so that the colors are displayed in reverse order.
  * @subcategory Gradients 
 * 
 * @example $.get('data/1fas.pqr', function(data){
      viewer.addModel(data, "pqr");
      $.get("data/1fas.cube",function(volumedata){
          viewer.addSurface($3Dmol.SurfaceType.VDW, {
              opacity:0.85,
              voldata: new $3Dmol.VolumeData(volumedata, "cube"),
              volscheme: new $3Dmol.Gradient.Sinebow(2,0,1)
          },{});
          
      viewer.render();
      });
      viewer.zoomTo();
  });
 */
export class Sinebow extends GradientType {
  gradient = "Sinebow";
  mult: number;
  max: number;
  min: number;
  constructor(min, max) {
    super();
    this.mult = 1.0;
    this.min = min;
    this.max = max;
    if (typeof max == "undefined" &amp;&amp; Array.isArray(min) &amp;&amp; min.length >= 2) {
      //we were passed a single range
      this.max = min[1];
      this.min = min[0];
    }
    if (max &lt; min) {
      //reverse the order
      this.mult = -1.0;
      this.min *= -1.0;
      this.max *= -1.0;
    }
  };

  //map value to hex color, range is provided
  valueToHex(val, range) {
    var lo, hi;
    val = this.mult * val;
    if (range) {
      lo = range[0];
      hi = range[1];
    } else {
      lo = this.min;
      hi = this.max;
    }

    if (typeof val == "undefined") return 0xffffff;
    var norm = Gradient.normalizeValue(lo, hi, val);
    lo = norm.lo;
    hi = norm.hi;
    val = norm.val;

    var scale = (val - lo) / (hi - lo);
    var h = (5 * scale) / 6.0 + 0.5;
    var r = Math.sin(Math.PI * h);
    r *= r * 255;
    var g = Math.sin(Math.PI * (h + 1 / 3.0));
    g *= g * 255;
    var b = Math.sin(Math.PI * (h + 2 / 3.0));
    b *= b * 255;

    return (
      0x10000 * Math.floor(r) + 0x100 * Math.floor(b) + 0x1 * Math.floor(g)
    );
  };

  //return range used for color mapping, null if none set
  range() {
    if (typeof this.min != "undefined" &amp;&amp; typeof this.max != "undefined") {
      return [this.min, this.max] as [number, number];
    }
    return null;
  };
}


/**
 * Custom linear gradient using user supplied colors.
 * Reverse gradients are supported when min>max so that the colors are displayed in reverse order.
 * Midpoints are not supported - color map should be specified to get desired middle color.
 * 
 * @param {number} min 
 * @param {number} max
 * @param {Array} colors  Array of colors that will be linearly interpolated between from min to max values.
 * @subcategory Gradients
 * 
 * @example
       $3Dmol.get('../test_structs/af.pdb', function(data){
              viewer.addModel(data);
              viewer.setStyle({cartoon:{colorscheme:{prop: 'b', gradient:'linear', min: 70, max: 100, colors: ["blue","yellow","green"]}}});
              viewer.zoomTo();
              viewer.render();
            });
 */
export class CustomLinear extends GradientType {
  gradient = "linear";
  min: number;
  max: number;
  colors = new Array&lt;Color>();

  constructor(min: any, max: any, colors?: any) {
    super();

    var carr: Array&lt;any>;
    if (Array.isArray(min) &amp;&amp; min.length >= 2) {
      //we were passed a single range
      this.max = min[1] as number;
      this.min = min[0] as number;
      carr = max;
    } else {
      this.min = min as number;
      this.max = max as number;
      carr = colors;
    }

    //convert colors
    if (carr) {
      for (let c of carr) {
        this.colors.push(CC.color(c));
      }
    } else {
      this.colors.push(CC.color(0));
    }

  }

  //return range used for color mapping, null if none set
  range() {
    if (typeof this.min != "undefined" &amp;&amp; typeof this.max != "undefined") {
      return [this.min, this.max] as [number, number];
    }
    return null;
  }

  //map value to hex color, range is provided
  valueToHex(val, range) {
    var lo, hi;
    if (range) {
      lo = range[0];
      hi = range[1];
    } else {
      lo = this.min;
      hi = this.max;
    }

    if (val === undefined) return 0xffffff;

    var norm = normalizeValue(lo, hi, val);
    lo = norm.lo;
    hi = norm.hi;
    val = norm.val;

    let nsteps = this.colors.length;
    let stepsize = (hi - lo) / nsteps;
    let startpos = Math.min(Math.floor((val - lo) / stepsize), nsteps - 1);
    let endpos = Math.min(startpos + 1, nsteps - 1);

    let frac = (val - lo - (startpos * stepsize)) / stepsize;

    let startcol = this.colors[startpos];
    let endcol = this.colors[endpos];

    let col = new Color(startcol.r + frac * (endcol.r - startcol.r),
      startcol.g + frac * (endcol.g - startcol.g),
      startcol.b + frac * (endcol.b - startcol.b));
    return col.getHex();
  }
}


//map from names to gradient constructors
export const builtinGradients = {
  rwb: RWB,
  RWB: RWB,
  roygb: ROYGB,
  ROYGB: ROYGB,
  sinebow: Sinebow,
  linear: CustomLinear
};

export class Gradient extends GradientType {
  static RWB = RWB;
  static ROYGB = ROYGB;
  static Sinebow = Sinebow;
  static CustomLinear = CustomLinear;
  static builtinGradients = builtinGradients;
  static normalizeValue = normalizeValue;
  static getGradient = getGradient;
  valueToHex(_value: number, _range?: number[]): number { return 0; }
  range(): [number, number] | null { return null; }
}</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>hljs.highlightAll();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
